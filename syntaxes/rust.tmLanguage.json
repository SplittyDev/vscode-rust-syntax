{
    "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
    "name": "rust",
    "scopeName": "source.rust",
    "patterns": [
        {
            "include": "#comment"
        },
        {
            "include": "#constant"
        },
        {
            "include": "#entity"
        },
        {
            "include": "#keyword"
        },
        {
            "include": "#meta"
        },
        {
            "include": "#punctuation"
        },
        {
            "include": "#storage"
        },
        {
            "include": "#string"
        },
        {
            "include": "#support"
        },
        {
            "include": "#unsorted"
        },
        {
            "include": "#variable"
        }
    ],
    "repository": {
        "comment": {
            "patterns": [
                {
                    "name": "comment.block.documentation.rust",
                    "begin": "/\\*[\\*!](?![\\*/])",
                    "end": "\\*/"
                },
                {
                    "name": "comment.block.rust",
                    "begin": "/\\*",
                    "end": "\\*/"
                },
                {
                    "name": "comment.line.documentation.rust",
                    "begin": "//[!/](?=[^/])",
                    "end": "$"
                },
                {
                    "name": "comment.line.double-slash.rust",
                    "begin": "//",
                    "end": "$"
                }
            ]
        },
        "constant": {
            "patterns": [
                {
                    "name": "constant.language.boolean.rust",
                    "match": "\\b(true|false)\\b"
                }
            ]
        },
        "entity": {
            "patterns": [
                {
                    "comment": "Invokation of a macro",
                    "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*\\!)\\s*[({\\[]",
                    "name": "entity.name.function.macro.rust"
                },
                {
                    "match": "\\b([A-Za-z][A-Za-z0-9_]*|_[A-Za-z0-9_]+)\\s*\\(",
                    "name": "entity.name.function.rust"
                },
                {
                    "comment": "Function definition",
                    "begin": "\\b(fn)\\s+([A-Za-z][A-Za-z0-9_]*|_[A-Za-z0-9_]+)",
                    "end": "[\\{;]",
                    "beginCaptures": {
                        "1": {
                            "name": "keyword.other.fn.rust"
                        },
                        "2": {
                            "name": "entity.name.function.rust"
                        }
                    }
                },
                {
                    "comment": "Function call with type parameters",
                    "begin": "\\b([A-Za-z][A-Za-z0-9_]*|_[A-Za-z0-9_]+)\\s*(::)(?=\\s*<.*>\\s*\\()",
                    "end": "\\(",
                    "captures": {
                        "1": {
                            "name": "entity.name.function.rust"
                        },
                        "2": {
                            "name": "keyword.operator.path.rust"
                        }
                    }
                },
                {
                    "comment": "Type declaration",
                    "begin": "\\b(enum|struct|trait|union)\\s+([a-zA-Z_][a-zA-Z0-9_]*)",
                    "end": "[\\{\\(;]",
                    "beginCaptures": {
                        "1": {
                            "name": "storage.type.rust"
                        },
                        "2": {
                            "name": "entity.name.type.rust"
                        }
                    }
                },
                {
                    "comment": "Type alias",
                    "begin": "\\b(type)\\s+([a-zA-Z_][a-zA-Z0-9_]*)",
                    "end": ";",
                    "beginCaptures": {
                        "1": {
                            "name": "storage.type.rust"
                        },
                        "2": {
                            "name": "entity.name.type.rust"
                        }
                    }
                }
            ]
        },
        "keyword": {
            "patterns": [
                {
                    "name": "keyword.control.rust",
                    "match": "\\b(break|continue|else|if|in|for|loop|match|return|while)\\b"
                },
                {
                    "name": "keyword.other.rust",
                    "match": "\\b(crate|extern|ref|use|super|move)\\b"
                },
                {
                    "name": "variable.language.self.rust",
                    "match": "\\b(self)\\b"
                },
                {
                    "name": "keyword.operator.sigil.rust",
                    "match": "[&*](?=[a-zA-Z0-9_\\(\\[\\|\\\"]+)"
                },
                {
                    "name": "keyword.other.unsafe.rust",
                    "match": "\\b(unsafe)\\b"
                },
                {
                    "name": "keyword.other.where.rust",
                    "match": "\\b(where)\\b"
                },
                {
                    "name": "keyword.operator.misc.rust",
                    "match": "(=>|\\bas\\b)"
                },
                {
                    "name": "keyword.operator.path.rust",
                    "match": "(::)"
                },
                {
                    "name": "keyword.operator.assignment.rust",
                    "match": "(\\+=|-=|/=|\\*=|%=|\\^=|&=|\\|=|<<=|>>=|=)"
                },
                {
                    "name": "keyword.operator.arithmetic.rust",
                    "match": "(!|\\+|-|/|\\*|%|\\^|&|\\||<<|>>)"
                }
            ]
        },
        "meta": {
            "patterns": [
                {
                    "name": "meta.attribute.rust",
                    "begin": "#\\!?\\[",
                    "end": "\\]"
                }
            ]
        },
        "storage": {
            "patterns": [
                {
                    "name": "storage.modifier.mutable.rust",
                    "match": "\\b(mut)\\b"
                },
                {
                    "name": "storage.modifier.box.rust",
                    "match": "\\b(box)\\b"
                },
                {
                    "name": "storage.modifier.const.rust",
                    "match": "\\b(const)\\b"
                },
                {
                    "name": "storage.modifier.visibility.rust",
                    "match": "\\b(pub)\\b"
                },
                {
                    "name": "storage.modifier.static.rust",
                    "match": "\\b(static)\\b"
                },
                {
                    "name": "storage.type.module.rust",
                    "match": "\\b(mod)\\b"
                },
                {
                    "name": "storage.type.rust",
                    "match": "\\b(let)\\b"
                },
                {
                    "name": "storage.type.rust",
                    "match": "\\b(enum|impl|struct|trait|union)\\b"
                }
            ]
        },
        "string": {
            "patterns": [
                {
                    "name": "constant.character.escape.rust",
                    "match": "\\\\(x[0-9A-Fa-f]{2}|[0-2][0-7]{0,2}|3[0-6][0-7]?|37[0-7]?|[4-7][0-7]?|.)"
                },
                {
                    "name": "constant.character.rust",
                    "match": "b?'([^'\\\\]|\\\\(x[0-9A-Fa-f]{2}|[0-2][0-7]{0,2}|3[0-6][0-7]?|37[0-7]?|[4-7][0-7]?|.))'"
                },
                {
                    "name": "string.quoted.double.rust",
                    "begin": "b?\"",
                    "end": "\""
                },
                {
                    "name": "string.quoted.double.raw.rust",
                    "begin": "b?r(#*)\"",
                    "end": "\"\\1"
                }
            ]
        },
        "support": {
            "patterns": [
                {
                    "comment": "Built-in macro",
                    "name": "support.function.builtin.rust",
                    "match": "\\b(macro_rules|compile_error|format_args|env|option_env|concat_idents|concat|line|column|file|stringify|include|include_str|include_bytes|module_path|cfg)!"
                },
                {
                    "comment": "Core macro",
                    "name": "support.function.core.rust",
                    "match": "\\b(panic|assert|assert_eq|assert_ne|debug_assert|debug_assert_eq|debug_assert_ne|try|write|writeln|unreachable|unimplemented)!"
                },
                {
                    "comment": "Standard library macro",
                    "name": "support.function.std.rust",
                    "match": "\\b(format|print|println|eprint|eprintln|select|vec)!"
                },
                {
                    "comment": "Logging macro",
                    "name": "support.function.log.rust",
                    "match": "\\b(log|error|warn|info|debug|trace|log_enabled)!"
                },
                {
                    "comment": "Core type variant",
                    "name": "support.constant.core.rust",
                    "match": "\\b(Some|None|Ok|Err)\\b"
                }
            ]
        },
        "unsorted": {
            "patterns": [
                {
                    "comment": "Named lifetime",
                    "name": "storage.modifier.lifetime.rust",
                    "match": "'([a-zA-Z_][a-zA-Z0-9_]*)\\b",
                    "captures": {
                        "1": {
                            "name": "entity.name.lifetime.rust"
                        }
                    }
                },
                {
                    "comment": "Reference with named lifetime",
                    "match": "&('([a-zA-Z_][a-zA-Z0-9_]*))\\b",
                    "captures": {
                        "1": {
                            "name": "storage.modifier.lifetime.rust"
                        },
                        "2": {
                            "name": "entity.name.lifetime.rust"
                        }
                    }
                },
                {
                    "comment": "Built-in/core type",
                    "name": "storage.type.core.rust",
                    "match": "\\b(bool|char|usize|isize|u8|u16|u32|u64|u128|i8|i16|i32|i64|i128|f32|f64|str|Self|Option|Result)\\b"
                },
                {
                    "comment": "Core trait (marker)",
                    "name": "support.type.marker.rust",
                    "match": "\\b(Copy|Send|Sized|Sync)\\b"
                },
                {
                    "comment": "Core trait",
                    "name": "support.type.core.rust",
                    "match": "\\b(Drop|Fn|FnMut|FnOnce|Clone|PartialEq|PartialOrd|Eq|Ord|AsRef|AsMut|Into|From|Default|Iterator|Extend|IntoIterator|DoubleEndedIterator|ExactSizeIterator)\\b"
                },
                {
                    "comment": "Standard library type",
                    "name": "storage.class.std.rust",
                    "match": "\\b(Box|String|Vec|Path|PathBuf)\\b"
                },
                {
                    "comment": "Standard library trait",
                    "name": "support.type.std.rust",
                    "match": "\\b(ToOwned|ToString)\\b"
                },
                {
                    "name": "meta.type_params.rust",
                    "begin": "<(?![=<])",
                    "end": "(?<![-])>"
                }
            ]
        }
    }
}